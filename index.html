<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Imtihon Platformasi</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background:#f0f2f5; padding:15px; user-select: none; }
        .card { background:white; padding:20px; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.08); margin-bottom:20px; }
        h3 { color:#0088cc; border-bottom:2px solid #eee; padding-bottom:10px; margin-top: 0; }
        label { display:block; margin-top:12px; font-weight:600; color: #333; }
        input, select { width:100%; padding:12px; margin:5px 0 10px 0; border-radius:10px; border:2px solid #dfe3e8; box-sizing: border-box; font-size: 16px; }
        
        .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        /* IKKI USTUNLI SAVOLLAR PANJARASI */
        .q-container { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            margin-top: 20px;
        }
        
        .q-card { 
            background: white; 
            padding: 10px; 
            border-radius: 12px; 
            border-left: 4px solid #0088cc; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
            display: flex;
            flex-direction: column;
        }
        
        .q-title { font-size: 14px; font-weight: bold; margin-bottom: 8px; }
        
        .options { display: flex; justify-content: space-between; align-items: center; }
        .options label { 
            margin: 0; 
            font-weight: bold; 
            font-size: 13px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }
        .options input { width: 18px; height: 18px; margin: 0 0 4px 0; cursor: pointer; }

        .btn { width:100%; padding:18px; background:#28a745; color:white; border:none; border-radius:12px; font-size:18px; cursor:pointer; margin-top:20px; transition: 0.3s; font-weight: bold; }
        .btn:active { transform: scale(0.98); }
    </style>
</head>
<body>

<div class="card">
    <h3>‚öôÔ∏è Test Sozlamalari</h3>
    <label>Ism va Familiya:</label>
    <input type="text" id="fullname" placeholder="Namuna: Ali Valiyev">
    
    <label>Test kodi (O'qituvchidan olingan):</label>
    <input type="text" id="testCode" placeholder="Masalan: 123">

    <label>Fan:</label>
    <select id="subject">
        <option value="Matematika">Matematika</option>
        <option value="Ona tili">Ona tili</option>
        <option value="Tarix">Tarix</option>
        <option value="Ingliz tili">Ingliz tili</option>
        <option value="Biologiya">Biologiya</option>
        <option value="Kimyo">Kimyo</option>
        <option value="Fizika">Fizika</option>
        <option value="Huquq">Huquq</option>
        <option value="IQ (Mantiq)">IQ (Mantiq)</option>
        <option value="Boshqa">Boshqa fanlar</option>
    </select>

    <div class="settings-grid">
        <div>
            <label>Savollar soni:</label>
            <input type="number" id="qCount" value="30" min="1" max="150" oninput="generateQuestions()">
        </div>
        <div>
            <label>Baholash formati:</label>
            <select id="gradingFormat">
                <option value="standard">Oddiy (1 ball)</option>
                <option value="dtm">DTM (1.1 / 2.1 / 3.1)</option>
            </select>
        </div>
    </div>
</div>

<div id="quizForm" class="q-container"></div>

<button type="button" id="submitBtn" class="btn" onclick="submitTest()">Natijani Yuborish üöÄ</button>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // SUPABASE URL va KEYni bu yerga qo'ying
    const SUPABASE_URL = 'https://hjwjomkywxnijfxnrwdt.supabase.co'; 
    const SUPABASE_KEY = 'sb_publishable_Xob1n96Fs5aqQlUZuhBbKA_eKn3jsuT'; 
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // SAHIFA YUKLANGANDA SAVOLLARNI GENERATSIYA QILISH
    window.onload = generateQuestions;

    function generateQuestions() {
        const container = document.getElementById('quizForm');
        const count = document.getElementById('qCount').value;
        container.innerHTML = ''; // Oldingilarni tozalash

        for (let i = 1; i <= count; i++) {
            const qCard = document.createElement('div');
            qCard.className = 'q-card';
            qCard.innerHTML = `
                <span class="q-title">${i}-savol</span>
                <div class="options">
                    <label><input type="radio" name="q${i}" value="A"> A</label>
                    <label><input type="radio" name="q${i}" value="B"> B</label>
                    <label><input type="radio" name="q${i}" value="C"> C</label>
                    <label><input type="radio" name="q${i}" value="D"> D</label>
                </div>
            `;
            container.appendChild(qCard);
        }
    }

    async function submitTest() {
        // Bu yerga oldingi xabarda berilgan natijani hisoblash va yuborish kodini qo'shasiz
        tg.showAlert("Natijangiz hisoblanmoqda...");
    }
    // Ilova ichida:
const tg = window.Telegram.WebApp;

function finishTest() {
    // 1. Ma'lumotlarni yig'ish
    const testCode = "101"; // Masalan inputdan olinadi
    const answers = "ABCD..."; // O'quvchi belgilagan javoblar
    
    // 2. Vaqtni hisoblash (Sekundda)
    // Ilova ochilganda startTime = Date.now() qilib olish kerak edi
    const durationSeconds = Math.floor((Date.now() - startTime) / 1000);

    // 3. Botga yuborish (KOD * JAVOBLAR * VAQT)
    const dataToSend = `${testCode}*${answers}*${durationSeconds}`;
    
    tg.sendData(dataToSend); // Bu funksiya botga "web_app_data" yuboradi
    tg.close();
}
</script>

</body>
</html>
