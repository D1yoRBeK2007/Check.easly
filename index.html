<<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Imtihon Platformasi</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background:#f0f2f5; padding:15px; user-select: none; }
        .card { background:white; padding:20px; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.08); margin-bottom:20px; }
        h3 { color:#0088cc; border-bottom:2px solid #eee; padding-bottom:10px; margin-top: 0; }
        label { display:block; margin-top:12px; font-weight:600; color: #333; }
        input, select { width:100%; padding:12px; margin:5px 0 10px 0; border-radius:10px; border:2px solid #dfe3e8; box-sizing: border-box; font-size: 16px; }
        input:focus, select:focus { border-color: #0088cc; outline: none; }
        
        .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        .btn { width:100%; padding:18px; background:#28a745; color:white; border:none; border-radius:12px; font-size:18px; cursor:pointer; margin-top:20px; transition: 0.3s; font-weight: bold; }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        
        .q-container { display:grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap:10px; }
        .q-card { background:white; padding:10px; border-radius:12px; border-left:4px solid #0088cc; box-shadow:0 2px 4px rgba(0,0,0,0.05); }
        .q-title { font-size: 14px; font-weight: bold; margin-bottom: 5px; display: block; }
        .options { display:flex; justify-content:space-between; }
        .options label { margin: 0; font-weight: normal; cursor: pointer; padding: 2px 5px; }
        .options input { width: auto; margin: 0 4px 0 0; }
    </style>
</head>
<body>

<div class="card">
    <h3>⚙️ Test Sozlamalari</h3>
    <label>Ism va Familiya:</label>
    <input type="text" id="fullname" placeholder="Namuna: Ali Valiyev">
    
    <label>Test kodi (O'qituvchidan olingan):</label>
    <input type="text" id="testCode" placeholder="Masalan: 123">

    <label>Fan:</label>
    <select id="subject">
        <option value="Matematika">Matematika</option>
        <option value="Ona tili">Ona tili</option>
        <option value="Tarix">Tarix</option>
        <option value="Ingliz tili">Ingliz tili</option>
        <option value="Biologiya">Biologiya</option>
        <option value="Kimyo">Kimyo</option>
        <option value="Fizika">Fizika</option>
        <option value="Huquq">Huquq</option>
        <option value="IQ (Mantiq)">IQ (Mantiq)</option>
        <option value="Boshqa">Boshqa fanlar</option>
    </style>
    </select>

    <div class="settings-grid">
        <div>
            <label>Savollar soni:</label>
            <input type="number" id="qCount" value="30" min="1" max="150" onchange="generateQuestions()">
        </div>
        <div>
            <label>Baholash formati:</label>
            <select id="gradingFormat">
                <option value="standard">Oddiy (1 ball)</option>
                <option value="dtm">DTM (1.1 / 2.1 / 3.1)</option>
            </select>
        </div>
    </div>
</div>

<form id="quizForm" class="q-container"></form>

<button type="button" id="submitBtn" class="btn" onclick="submitTest()">Natijani Yuborish</button>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // ---------------------------------------------------------
    // ⚠️ SUPABASE SOZLAMALARI (O'ZINGIZNIKINI QO'YING)
    // ---------------------------------------------------------
    const SUPABASE_URL = 'hjwjomkywxnijfxnrwdt'; 
    const SUPABASE_KEY = 'sb_publishable_Xob1n96Fs5aqQlUZuhBbKA_eKn3jsuT';
    // ---------------------------------------------------------

    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Savollarni generatsiya qilish (Soni o'zgarganda ishlaydi)
    function generateQuestions
